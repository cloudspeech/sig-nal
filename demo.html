<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="robots" content="noindex, nofollow"/>
    <meta name="description" content=""/>
    <link rel="icon" href="favicon.png"/>
    <title>Demo | sig-nal</title>
    <link href="style.css" rel="stylesheet" type="text/css">
    <script type="module" src="src/index.js"></script>
  </head>
  <body>
    <div id="counter1">
      <template shadowrootmode="open">
	<style>button{box-shadow:1px 2px 3px rgba(0,0,0,.3);padding:.5rem;cursor:pointer}</style>
	<h1>
	  <a href="https://github.com/cloudspeech/sig-nal" target="_blank" !title="counter" .textContent="title"><sig-nal ref="title"></sig-nal></a>
	</h1>
	<div class="container">
	  <button @click="counter">
	    <sig-nal ref="inc">+</sig-nal>
	  </button>
	  <span .textContent="counter">
	    <sig-nal new="counter" type="number">0</sig-nal>
          </span>
	  <button @click="counter">
	    <sig-nal ref="dec">-</sig-nal>
	  </button>
	</div>
      </template>
    </div>

    <div class="counter2">
      <template shadowrootmode="open">
	<style>button{box-shadow:1px 2px 3px rgba(0,0,0,.3);padding:.5rem;cursor:pointer}</style>
	<h1 !title="counter">
	  <sig-nal ref="title">Counters</sig-nal>
	</h1>
	<div class="container">
	  <button @click="counter">
	    <sig-nal ref="inc">+</sig-nal>
	  </button>
	  <span .textContent="counter">
	    <sig-nal new="counter" type="number">0</sig-nal>
          </span>
	  <button @click="counter">
	    <sig-nal ref="dec">-</sig-nal>
	  </button>
	</div>
      </template>
    </div>

    <div class="clock">
      <template shadowrootmode="open">
	<style>.weekday:after{content:','}.day:after{content:'.'}.hour:after,.minute:after{content:':';margin-right: -2px}</style>
	<h1>Date and Time</h1>
	<table><tr>
	  <td class="weekday" .textContent="weekday"><sig-nal new="weekday" id="weekday">Freitag</sig-nal></td>
	  <td class="day" .textContent="day"><sig-nal new="day" id="day">19</sig-nal></td>
	  <td class="month" .textContent="month"><sig-nal new="month" id="month">April</sig-nal></td>
	  <td class="year" .textContent="year"><sig-nal new="year" id="year">2024</sig-nal></td>
	  <td class="hour" .textContent="hour"><sig-nal new="hour" id="hour">11</sig-nal></td>
	  <td class="minute" .textContent="minute"><sig-nal new="minute" id="minute">53</sig-nal></td>
	  <td .textContent="second"><sig-nal new="second" id="second">24</sig-nal></td>
	  <td .textContent="timeZoneName"><sig-nal new="timeZoneName" id="timeZoneName">MESZ</sig-nal></td>
	</tr></table>
      </template>
    </div>

    <footer>
      <details><summary>Info</summary>
	<p>Demo (c) 2024 by Markus Walther. Witness how both counter instances are independent of each other, thanks to shadowRoot scoping! In Chrome DevTools, enable Rendering &rarr; Paint flashing to see fine-grained DOM updates!</p>
      </details>
    </footer>

    <script type="module">
const {hydrate, render, rerender} = await customElements.whenDefined("sig-nal");

hydrate(["div#counter1", "div.counter2"], {
  title: {
    "!title": rerender,
    ".textContent": render(document.title)
  },
  counter: { ".textContent": rerender },
  inc: { "@click": ({ signal }) => signal.value++ },
  dec: { "@click": ({ signal }) => signal.value-- },
});

const clockSignals = {},
  last = [];

const dateParts = () =>
  Intl.DateTimeFormat("de-CH", { dateStyle: "full", timeStyle: "long" })
    .formatToParts(new Date())
    .filter(
      ({ type, value }, i) => type !== "literal" && value !== last[i]?.value,
    );

const generate = (parts) => {
  const renderSpec = {};
  parts.forEach(
    ({ type, value }) => (renderSpec[type] = { ".textContent": rerender }),
  );
  return renderSpec;
};

hydrate(["div.clock"], generate(dateParts()), clockSignals);

const updateDateParts = () =>
  dateParts().forEach(({ type, value }) => (clockSignals[type].value = value));

setInterval(updateDateParts, 1000);
    </script>
  </body>
</html>
