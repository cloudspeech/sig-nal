let t,e=[],i=[],n=0,s=-1,r=[],l=[],a=[],o=new FinalizationRegistry(t=>i[t]=null),d=t=>{let e=a[t],i=l[t]();u(e,i)},u=(t,n)=>{i[t]=n;for(let i of r[t]||e){let t=typeof i;"function"===t?i():"number"===t&&d(i)}return n};class c{#t;constructor(){this.#t=++n,o.register(this,n)}get value(){let e=this.#t,n=t;return n?.indexOf(e)<0&&(n.push(e),n.sort()),i[e]}set value(t){return u(this.#t,t)}valueOf=()=>this.value;toString=()=>String(this.value);effect=(t,e)=>((t,e,i)=>{i&&e();let n=r[t]=r[t]||[],s=n.length;return n[s]=e,[t,s]})(this.#t,t,e)}let h=i=>{let n=new c,l=t||e;for(let t;t=l.shift();)r[t]||(r[t]=[]),r[t].push(s);return n.value=i,n},g=e=>{t=[];let i=++s;l[i]=e,a[i]=n+1;let r=h(e());return t=null,r};class f extends WeakMap{use=(t,e={})=>this.get(t)||this.set(t,e).get(t)}let p=new f,y=new Proxy({},{get:async(t,e)=>(await import("./plugins/"+e+".js")).default}),m=(t,e,i,n,s,r,l)=>{let{getById:a,ctx:o}=t,d=r.getAttribute(i),u=p.get(o.scope),c=u&&u[d||t.name];return d&&queueMicrotask(()=>r.removeAttribute(i)),t=>i=>t({getById:a,ctx:o,name:s,signal:c,signals:u,nodes:l,id:e,kind:n,e:i,plugins:y})};class A extends HTMLElement{#e=t=>this.getAttribute(t);static signal=h;static computed=g;static plugin=t=>e=>e.plugins[e.name].then(i=>i(e)(t(e)));static hydrate=t=>e=>{let{getById:i,root:n}=e,s=new Proxy({},{get:(t,e)=>i(e)});for(let r in t){let l=t[r];for(let t in l){let[a,o,d,u={}]=[l[t],t.slice(1),t[0]];Array.isArray(a)&&([a,u]=[a[0],a[1]]);let c="@.?!:".indexOf(d);if(c<0)continue;let h=r?i(r):n,g=m(e,r,t,c,o,h,s)(a);c?g():h.addEventListener(o,g,u)}}};static clone=(t,e=["hidden",!1],i=!0)=>{let n=t.cloneNode(i);for(let t=0,i=e.length;t<i;t+=2)n[e[t]]=e[t+1];return n};static index=(t,e=t.map(t=>t.slice(1)))=>({getById:i,ctx:{name:n},signal:s})=>(r=s.value)=>{for(let s,l,a,o,d=0,u=0|r?.length;d<u;d++)if(s=r[d],a=Array.isArray(s),l=i(n+d),void 0!==s&&l){o=0;for(let i of t)l.hasAttribute(i)&&(l[e[o]]=a?s[o]:s),o++}};static render=({signal:t,getById:e,id:i,name:n,kind:s})=>(r=t.value,l=e(i))=>{r="function"==typeof r?r():r,/^dataset\.\S+/.test(n)?l.dataset[n.slice(8)]=r:null!==r&&(4===s?l[n](r):l[n]=r)};static renderWith=(t,e=!0)=>i=>i.signal.effect(t(i),e);static rerender=A.renderWith(A.render);constructor(){super();let t=this.root=this[this.#e("for")||"parentNode"],e=this.#e("scope");e=e?this.closest(e):this.getRootNode();let i=e instanceof ShadowRoot,n=this.#e("new"),s=(this.name=n)||this.#e("ref")||crypto.randomUUID(),r=this.#e("type"),[l,a]=(this.#e("default")||"").split("#"),{id:o,textContent:d}=this;if(this.getById=i?e=>t.querySelector("#"+e):t=>document.getElementById(t),this.ctx={root:t,scope:e,name:s,type:r,id:o,description:d},n){let t=l?this.getById(a)[l.slice(1)]:this.#e("value");p.use(e)[s]=h(((t,e)=>"number"===e?0|t:t)(t,r))}if(null!==this.#e("index")){let e=document.createTreeWalker(t,1),i=0;for(;e.nextNode();){let t=e.currentNode;t!==this&&t.id===s&&(t.id=s+i++)}}null!==this.#e("hydrate")&&(new Function(`let{hydrate,render,rerender,renderWith,index,plugin,computed,clone}=customElements.get('sig-nal');return hydrate(${d})`)()(this),d="",t.dispatchEvent(new Event("init"))),this.className||this.replaceWith(d)}}customElements.define("sig-nal",A);
