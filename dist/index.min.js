let e={},t=[(e,t)=>e[t],(e,t)=>e.hasAttribute(t),(e,t)=>e.getAttribute(t),e=>1,e=>0];class i extends WeakMap{use=(e,t={})=>this.get(e)||this.set(e,t).get(e)}let s={},n=new i,r=new i,a=new i,{body:o}=document,l={},d=(e,t)=>"number"===t?0|e:e,c=(e=o,t=[])=>e.__proto__?c(e.__proto__,t.concat(Object.getOwnPropertyNames(e))):[...new Set(t.concat(Object.getOwnPropertyNames(e)))];for(let e of c()){let t="function"==typeof o[e]?":":".";l[t+e.toLowerCase()]=e}class h{#e;#t=[];#i=0;constructor(e){this.#e=e}#s=()=>1==++this.#i&&queueMicrotask((()=>{this.#t.map((e=>e())),this.#i=0}));get value(){return this.#e}set value(e){this.#e=e,this.#s()}onChange(e,t,i=this.#t.length,s=(()=>e(this.#e))){return t&&s(),this.#t[i]=s,i}when(e,t=[]){let i=new h;return this.onChange((t=>i.value=e(t)),!0),t.map((e=>e.onChange(this.#s))),i}}let u={},f={};class g extends HTMLElement{#n=(e,t=this)=>t.getAttribute(e);#r=(e,i)=>{let s=e[0],n=e.slice(1),a=this.#n(e,i),o=".?!@:".indexOf(s);if(o>=0){let s=t[o](i,n);r.use(i)[e]={init:s,name:a,kind:o},queueMicrotask((()=>i.removeAttribute(e)))}};static Signal=h;static hydrate=(t,i,o)=>{let l="string"==typeof t?s[t]:t.map((e=>document.querySelector(e).shadowRoot));for(let t of l)if(!t.h){t.h=1;let s=a.get(t)||e;for(let a in i){let l=a,d=n.get(t),c=d[a],h=r.get(c);if(h){let n=i[a];for(let i in n){let r=n[i];i in u&&(r=u[i](r));let{name:a,init:f,kind:g}=h[i.toLowerCase()]||e,{signal:m,type:p,id:y}=a&&s[a]||e;o instanceof Object&&y&&m&&(o[y]=m);let A=i.slice(1),w=e=>r({type:p,name:A,signal:m,signals:s,init:f,kind:g,domNode:c,domNodes:d,scope:t,descriptor:l,e:e});a&&(i.startsWith("@")?c.addEventListener(A,w):queueMicrotask(w))}}}}};static plugin=(e,t)=>(u[e]=t)&&f[e]&&f[e]();static usable=(e,t=[])=>{for(let i of e)u[i]||t.push(new Promise((e=>f[i]=e)));return Promise.all(t)};static render=e=>({domNode:t,name:i,kind:s})=>{e="function"==typeof e?e():e,/^dataset\.\S+/.test(i)?t.dataset[i.slice(8)]=e:null!==e&&(4===s?t[i](e):t[i]=e)};static renderWith=e=>(t,i=!0)=>t.signal.onChange(e(t),i);static rerender=g.renderWith((e=>t=>g.render(t)(e)));static index=({scope:e,descriptor:t})=>i=>{for(let s,n,r=0,a=i.length;r<a;r++)if(s=i[r],s){n=e.getElementById(`${t}${r}`);for(let e,t=0,i=n.getAttributeNames(),r=i.length,a=0,o=Array.isArray(s);t<r;t++)e=i[t],e in l&&(n[l[e]]=o?s[a++]:s)}};connectedCallback(){let e=this[this.#n("for")||"parentNode"],t=this.#n("scope");t=t?this.closest(t):this.getRootNode();let i=this.#n("new"),r=i||this.#n("ref")||crypto.randomUUID(),o=this.#n("type"),{id:l,textContent:c}=this;(s[r]=s[r]||[]).push(t),n.use(t)[r]=e,i&&(a.use(t)[r]={signal:new h(d(c||this.#n("value"),o)),type:o,id:l});for(let t of e.getAttributeNames())this.#r(t,e);if(null!==this.#n("index")){let t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),i=0;for(;t.nextNode();){let e=t.currentNode;e.id===r&&(e.id=`${r}${i++}`)}}null!==this.#n("hydrate")&&(new Function(`let{hydrate,render,rerender,renderWith,index}=customElements.get('sig-nal');hydrate('${r}',${c})`)(),c=""),this.className||this.replaceWith(c)}}customElements.define("sig-nal",g);
