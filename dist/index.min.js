let e={},t=[(e,t)=>e[t],(e,t)=>e.hasAttribute(t),(e,t)=>e.getAttribute(t),e=>1,e=>0],i=["selectedIndex"];class n extends WeakMap{use=(e,t={})=>this.get(e)||this.set(e,t).get(e)}let s={},r=new n,a=new n,o=new n,{body:l}=document,d={},c=(e,t)=>"number"===t?0|e:e,h=(e=l,t=[])=>e.__proto__?h(e.__proto__,t.concat(Object.getOwnPropertyNames(e))):[...new Set(t.concat(Object.getOwnPropertyNames(e)))];for(let e of[...h(),...i]){let t=typeof l[e];d[("function"===t?":":".")+e.toLowerCase()]=e}class u{#e;#t=[];#i=0;constructor(e){this.#e=e}#n=()=>1==++this.#i&&queueMicrotask((()=>{this.#t.map((e=>e())),this.#i=0}));get value(){return this.#e}set value(e){this.#e=e,this.#n()}onChange(e,t,i=this.#t.length,n=()=>e(this.#e)){return t&&n(),this.#t[i]=n,i}when(e,t=[]){let i=new u;return this.onChange((t=>i.value=e(t)),!0),t.map((e=>e.onChange(this.#n))),i}}let f={},g={};class m extends HTMLElement{#s=(e,t=this)=>t.getAttribute(e);#r=(e,i)=>{let n=e[0],s=e.slice(1),r=this.#s(e,i),o=".?!@:".indexOf(n);if(o>=0){let n=t[o](i,s);a.use(i)[e]={init:n,name:r,kind:o},queueMicrotask((()=>i.removeAttribute(e)))}};static Signal=u;static hydrate=(t,i,n)=>{let l="string"==typeof t?s[t]:t.map((e=>document.querySelector(e).shadowRoot));for(let t of l)if(!t.h){t.h=1;let s=o.get(t)||e;for(let o in i){let l=o,d=r.get(t),c=d[o],h=a.get(c);if(h){let r=i[o];for(let i in r){let a=r[i];i in f&&(a=f[i](a));let{name:o,init:u,kind:g}=h[i.toLowerCase()]||e,{signal:m,type:p,id:y}=o&&s[o]||e;n instanceof Object&&y&&m&&(n[y]=m);let A=i.slice(1),w=e=>a({type:p,name:A,signal:m,signals:s,init:u,kind:g,domNode:c,domNodes:d,scope:t,descriptor:l,e:e});o&&(i.startsWith("@")?c.addEventListener(A,w):queueMicrotask(w))}}}}};static plugin=(e,t)=>(f[e]=t)&&g[e]&&g[e]();static usable=(e,t=[])=>{for(let i of e)f[i]||t.push(new Promise((e=>g[i]=e)));return Promise.all(t)};static render=e=>({domNode:t,name:i,kind:n})=>{e="function"==typeof e?e():e,/^dataset\.\S+/.test(i)?t.dataset[i.slice(8)]=e:null!==e&&(4===n?t[i](e):t[i]=e)};static renderWith=(e,t=!0)=>i=>i.signal.onChange(e(i),t);static rerender=m.renderWith((e=>t=>m.render(t)(e)));static index=({scope:e,descriptor:t})=>i=>{for(let n,s,r,a=0,o=i.length;a<o;a++)if(n=i[a],void 0!==n){r=t+a,s=e instanceof DocumentFragment?e.getElementById(r):e.querySelector("#"+r);for(let e,t=0,i=s.getAttributeNames(),r=i.length,a=0,o=Array.isArray(n);t<r;t++)e=i[t],e in d&&(s[d[e]]=o?n[a++]:n)}};connectedCallback(){let e=this[this.#s("for")||"parentNode"],t=this.#s("scope");t=t?this.closest(t):this.getRootNode();let i=this.#s("new"),n=i||this.#s("ref")||crypto.randomUUID(),a=this.#s("type"),{id:l,textContent:d}=this;(s[n]=s[n]||[]).push(t),r.use(t)[n]=e,i&&(o.use(t)[n]={signal:new u(c(d||this.#s("value"),a)),type:a,id:l});for(let t of e.getAttributeNames())this.#r(t,e);if(null!==this.#s("index")){let t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),i=0;for(;t.nextNode();){let e=t.currentNode;e.id===n&&(e.id=`${n}${i++}`)}}null!==this.#s("hydrate")&&(new Function(`let{hydrate,render,rerender,renderWith,index}=customElements.get('sig-nal');hydrate('${n}',${d})`)(),d="",e.dispatchEvent(new Event("init"))),this.className||this.replaceWith(d)}}customElements.define("sig-nal",m);
