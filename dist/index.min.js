let t,e=[],i=[],s=0,r=-1,n=[],l=[],a=[],o=new FinalizationRegistry((t=>i[t]=null)),d=t=>{let e=a[t],i=l[t]();u(e,i)},u=(t,s)=>{i[t]=s;for(let i of n[t]||e){let t=typeof i;"function"===t?i():"number"===t&&d(i)}return s};class c{#t;constructor(){this.#t=++s,o.register(this,s)}get value(){let e=this.#t,s=t;return s?.indexOf(e)<0&&(s.push(e),s.sort()),i[e]}set value(t){return u(this.#t,t)}valueOf=()=>this.value;toString=()=>String(this.value);effect=(t,e)=>((t,e,i)=>{i&&e();let s=n[t]=n[t]||[],r=s.length;return s[r]=e,[t,r]})(this.#t,t,e)}let h=i=>{let s=new c,l=t||e;for(let t;t=l.shift();)n[t]||(n[t]=[]),n[t].push(r);return s.value=i,s},f=e=>{t=[];let i=++r;l[i]=e,a[i]=s+1;let n=h(e());return t=null,n};class g extends WeakMap{use=(t,e={})=>this.get(t)||this.set(t,e).get(t)}let y=new g,m={},p={},A=(t,e,i,s,r,n)=>{let{getById:l,ctx:a}=t,o=n.getAttribute(i),d=y.get(a.scope),u=d[o];return queueMicrotask((()=>n.removeAttribute(i))),t=>i=>t({getById:l,ctx:a,name:r,signal:u,signals:d,id:e,kind:s,e:i})};class v extends HTMLElement{#e=t=>this.getAttribute(t);getById=null;ctx=null;static signal=h;static computed=f;static hydrate=t=>e=>{for(let i in t){let s=t[i];for(let t in s){let[r,n,l,a={}]=[s[t],t.slice(1),t[0]];Array.isArray(r)&&([r,a]=[r[0],r[1]]);let o="@.?!:".indexOf(l);if(o<0)continue;let{getById:d,root:u}=e,c=i?d(i):u,h=A(e,i,t,o,n,c)(r);o?h():c.addEventListener(n,h,a)}}};static plugin=(t,e)=>(m[t]=e)&&p[t]&&p[t]();static usable=(t,e=[])=>{for(let i of t)m[i]||e.push(new Promise((t=>p[i]=t)));return Promise.all(e)};static index=(t,e=t.map((t=>t.slice(1))))=>({getById:i,ctx:{name:s},signal:r})=>(n=r.value)=>{for(let r,l,a,o,d=0,u=n.length;d<u;d++)if(r=n[d],a=Array.isArray(r),void 0!==r){l=i(s+d),o=0;for(let i of t)l.hasAttribute(i)&&(l[e[o]]=a?r[o]:r),o++}};static render=({signal:t,getById:e,id:i,name:s,kind:r})=>(n=t.value,l=e(i))=>{n="function"==typeof n?n():n,/^dataset\.\S+/.test(s)?l.dataset[s.slice(8)]=n:null!==n&&(4===r?l[s](n):l[s]=n)};static renderWith=(t,e=!0)=>i=>i.signal.effect(t(i),e);static rerender=v.renderWith(v.render);constructor(){super();let t=this.root=this[this.#e("for")||"parentNode"],e=this.#e("scope");e=e?this.closest(e):this.getRootNode();let i=e instanceof ShadowRoot,s=this.#e("new"),r=s||this.#e("ref")||crypto.randomUUID(),n=this.#e("type"),[l,a]=(this.#e("default")||"").split("#"),{id:o,textContent:d}=this;if(this.getById=i?e=>t.querySelector("#"+e):t=>document.getElementById(t),this.ctx={root:t,scope:e,name:r,type:n,id:o,description:d},s){let t=l?this.getById(a)[l.slice(1)]:this.#e("value");y.use(e)[r]=h(((t,e)=>"number"===e?0|t:t)(t,n))}if(null!==this.#e("index")){let e=document.createTreeWalker(t,1),i=0;for(;e.nextNode();){let t=e.currentNode;t!==this&&t.id===r&&(t.id=r+i++)}}null!==this.#e("hydrate")&&(new Function(`let{hydrate,render,rerender,renderWith,index}=customElements.get('sig-nal');return hydrate(${d})`)()(this),d="",t.dispatchEvent(new Event("init"))),this.className||this.replaceWith(d)}}customElements.define("sig-nal",v);
