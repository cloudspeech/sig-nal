<!doctype html>
<html lang="en-US">
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      name="description"
      content="sig-nal bluesky real-time messages demo" />
    <title>sig-nal | bluesky real-time messages demo</title>
    <script type="module" src="./src/index.js"></script>
  </head>
  <body>
    <template shadowrootmode="open">
      <style>
        * {
          font-family: sans-serif;
        }
        p {
          color: #fff;
          background: #555;
          padding: 0.5rem;
          width: fit-content;
        }
        ul {
          margin: 0;
          padding: 0;
        }
        li {
          width: 100%;
          overflow-x: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          content-visibility: auto;
        }
      </style>
      <h1>Bluesky real-time messages demo</h1>
      <p>showing the last 10 messages</p>
      <div @init="messages" .firstElementChild="messages">
        <ul>
          <li id="messages0" .textContent>loading...</li>
          <li id="messages1" .textContent>loading...</li>
          <li id="messages2" .textContent>loading...</li>
          <li id="messages3" .textContent>loading...</li>
          <li id="messages4" .textContent>loading...</li>
          <li id="messages5" .textContent>loading...</li>
          <li id="messages6" .textContent>loading...</li>
          <li id="messages7" .textContent>loading...</li>
          <li id="messages8" .textContent>loading...</li>
          <li id="messages9" .textContent>loading...</li>
        </ul>
        <sig-nal new="messages" hydrate>
          {"": { "@init": ({signal}) => { signal.value = Array(10); let ws = new
          WebSocket('wss://jetstream2.us-west.bsky.network/subscribe?wantedCollections=app.bsky.feed.post');
          ws.onmessage = event => { let {kind, commit} = JSON.parse(event.data);
          if (kind !== 'commit' || commit.operation !== 'create') return; let
          message = commit.record.text.replaceAll(/\n/g, ' '); let filter =
          location.search.slice(1); if (filter && !message.includes(filter))
          return; let last10 = signal.value; last10.push(message);
          last10.shift(); signal.value = last10; }; }, ".firstElementChild":
          renderWith(index(['.textContent']),false) }}
        </sig-nal>
      </div>
    </template>
  </body>
</html>
